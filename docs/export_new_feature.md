# 新CSV导出功能说明

## 概述
新增的`--export-new`功能提供了一个简化的CSV导出选项，只导出数据库中的关键字段，便于后续数据分析和处理。

## 功能特点

### 1. 选择性字段导出
- 不再导出所有数据库字段
- 只导出最核心的统计信息
- 减少文件大小，提高处理效率

### 2. 结构化数据组织
- 两个数据表分别导出
- 清晰的分隔和标题
- 便于导入到其他分析工具

### 3. 自动排序
- matches表按capture_sequence和unit_name排序
- template_stats表按id排序
- 便于数据查看和分析

## 使用方法

### 基本用法
```bash
python run.py --export-new
```

### 输出文件
- 默认文件名：`export_new.csv`
- 文件位置：项目根目录
- 编码格式：UTF-8

## 导出字段说明

### matches表字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| capture_sequence | INTEGER | 截图序列号（当前session下的截图次数） |
| unit_name | TEXT | 单位名称（不含费用和扩展名） |
| cost | INTEGER | 费用（1-5） |
| ocr_number | INTEGER | OCR识别的数字（可能为空） |

### template_stats表字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 模板统计记录ID |
| unit_name | TEXT | 单位名称（不含费用和扩展名） |
| cost | INTEGER | 费用（1-5） |
| total_matches | INTEGER | 该模板的总匹配次数 |

## CSV文件格式示例

```csv
=== MATCHES TABLE ===
capture_sequence,unit_name,cost,ocr_number
1,Aatrox,1,6
1,Dr. Mundo,2,8
1,Malzahar,3,8
2,Ashe,4,7
2,Jayce,3,8

=== TEMPLATE_STATS TABLE ===
id,unit_name,cost,total_matches
1,Xin Zhao,2,3
2,Ashe,4,2
3,Udyr,3,5
4,Dr. Mundo,2,4
5,Kayle,1,2
```

## 数据关系说明

### capture_sequence
- 表示在同一个会话中的截图顺序
- 从1开始递增
- 相同序列号的记录表示同一次截图的结果

### unit_name 和 cost
- 这两个字段在matches和template_stats表中保持一致
- 便于进行数据关联分析
- 支持按费用或单位名称进行分组统计

### ocr_number
- 可能为空值（NULL）
- 表示OCR识别失败或未启用OCR功能
- 有效值范围：0-10

## 使用场景

### 1. 数据分析
- 分析不同费用的单位出现频率
- 统计每个单位的匹配次数
- 追踪截图序列中的模式

### 2. 数据导入
- 导入到Excel进行进一步分析
- 导入到Python pandas进行数据处理
- 导入到其他统计软件进行分析

### 3. 报告生成
- 生成TFT游戏统计报告
- 分析游戏策略和单位选择
- 追踪游戏进程和变化

## 与其他导出功能的区别

### 原有导出功能
- 导出所有数据库字段
- 包含详细的匹配信息
- 文件较大，信息完整

### 新导出功能
- 只导出核心统计字段
- 文件较小，便于处理
- 专注于关键数据分析

## 注意事项

### 1. 数据完整性
- 确保数据库中有数据
- 建议在运行统计功能后再导出
- 检查导出的记录数量是否合理

### 2. 文件编码
- 使用UTF-8编码，支持中文
- 确保查看工具支持UTF-8
- 避免在Excel中直接打开（可能乱码）

### 3. 数据更新
- 导出的是当前数据库的快照
- 后续的数据库操作不会影响已导出的文件
- 需要最新数据时重新导出

## 故障排除

### 常见问题

#### 1. 导出失败
- 检查数据库文件是否存在
- 确认有写入权限
- 检查磁盘空间

#### 2. 数据为空
- 确认数据库中有数据
- 检查是否运行过统计功能
- 验证数据库结构是否正确

#### 3. 文件格式问题
- 使用支持UTF-8的文本编辑器
- 避免使用Windows记事本
- 推荐使用VS Code、Notepad++等

## 总结

新的CSV导出功能提供了：
- 简化的数据导出
- 核心字段的快速访问
- 便于后续分析的数据格式
- 清晰的数据组织结构

这个功能特别适合需要快速获取关键统计数据的场景，为TFT卡牌统计分析提供了便捷的数据导出选项。
